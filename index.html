<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Avatar Generator</title>
  </head>
  <body style="text-align: center">
    <canvas id="unity-canvas" width=800 height=600 style="width: 800px; height: 600px; background: #231F20"></canvas>
    <img id="display_image" src="" alt="">
    <script src="Build/POCAT14.loader.js"></script>
    <script>
      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/POCAT14.data",
        frameworkUrl: "Build/POCAT14.framework.js",
        codeUrl: "Build/POCAT14.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "Novathena",
        productName: "Avatar Generator",
        productVersion: "0.1.1",
        // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
        // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
      });

      function LoadImage(key) {

        window.alert(key);
        console.log(key);

        // IndexedDB
        var indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.OIndexedDB || window.msIndexedDB,
            IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.OIDBTransaction || window.msIDBTransaction,
            dbVersion = 21;

        let db;
        // Create/open database
        var request = indexedDB.open("/idbfs", dbVersion)
        request.onsuccess = function(e){

            console.log("Success creating/accessing IndexedDB database");

            db = request.result;
            var transaction = db.transaction(["FILE_DATA"], IDBTransaction.READ_WRITE);
            transaction.objectStore("FILE_DATA").get(key).onsuccess = function (event) {
                var imgFile = event.target.result;
                console.log(imgFile);

                var blob = new Blob([imgFile.contents], { type: "image/png" });

                // Create and revoke ObjectURL
                var imgURL = (window.URL) ? window.URL.createObjectURL(blob) : window.webkitURL.createObjectURL(blob);

                // Set img src to ObjectURL
                var img = document.getElementById("display_image");
                img.setAttribute("src", imgURL);
            };
        }

        request.onerror = function (event) {
            console.log("Error creating/accessing IndexedDB database");
        };
      }
    </script>
  </body>
</html>